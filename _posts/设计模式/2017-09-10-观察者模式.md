---
layout: post
title: è§‚å¯Ÿè€…æ¨¡å¼
tags:
category: è®¾è®¡æ¨¡å¼
---

# publisher - subscriber

> å‘å¸ƒè€… + è®¢é˜…è€… = è§‚å¯Ÿè€…æ¨¡å¼


## ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼?

* ä¸€å›¾è§£åƒè¨€



* UML ç±»å›¾


![image.png | left | 496x327](https://private-alipayobjects.alipay.com/alipay-rmsdeploy-image/skylark/png/5f8c61377f7292b9.png "")

## ç‰¹ç‚¹ï¼Ÿ

* äº‹ä»¶é©±åŠ¨è½¯ä»¶ç¨‹åº
* ä¸€å¯¹å¤šä¾èµ–(å½“ä¸€ä¸ªå¯¹è±¡å‘ç”Ÿæ”¹å˜ï¼Œä»–çš„ä¾èµ–è€…éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶ä¸”è‡ªåŠ¨æ›´æ–°)
* çœŸæ­£æ‹¥æœ‰æ•°æ®çš„äººæ˜¯ ä¸»é¢˜å¯¹è±¡ï¼ˆä¸»é¢˜å¯¹è±¡æ‹¥æœ‰çŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶çŠ¶æ€ï¼‰ï¼Œè€Œè§‚å¯Ÿè€…ä¾èµ–ä¸»é¢˜å¯¹è±¡çš„é€šçŸ¥ï¼Œæ„ŸçŸ¥çŠ¶æ€çš„å˜åŒ–


## å¦‚ä½•åˆç†åˆ©ç”¨ï¼Ÿ
### å®ä¾‹
* **Ember ï¼ˆå¤§é‡ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼)**


### åœºæ™¯
* è§‚å¯Ÿè€…æ¨¡å¼çš„ç¼ºç‚¹å°±æ˜¯è§‚å¯Ÿè€…åªçŸ¥é“æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œå´æ— æ³•å¾—çŸ¥å¦‚ä½•å‘ç”Ÿå˜åŒ–ã€‚ä¸ä¹‹é€‚ç”¨åœºæ™¯: ç³»ç»Ÿå­˜åœ¨ä¸€æ¡è§¦å‘é“¾ï¼ŒAå¯¹è±¡è¡Œä¸ºå½±å“Bå¯¹è±¡ï¼ŒBå¯¹è±¡è¡Œä¸ºå½±å“Cå¯¹è±¡â€¦ï¼ˆä½†æ— éœ€çŸ¥é“å…·ä½“çš„å˜åŒ–åŸå› ï¼‰


## ä¸¾ä¾‹
* å…·ä½“æƒ…å†µ:  æ°”è±¡ç«™è·å–å¤©æ°”æ°”è±¡æ•°æ®`WeatherDataï¼Œ` ç„¶åé€šè¿‡å¸ƒå‘Šæ¿æ˜¾ç¤ºã€‚
  * `WeatherData`ç±»å…·æœ‰getteræ–¹æ³•,æœ‰ä¸‰ä¸ªæµ‹é‡å€¼: `æ¸©åº¦`ï¼Œ`æ¹¿åº¦`å’Œ`æ°”å‹`ã€‚
  * å¸ƒå‘Šæ¿æœ‰ä¸‰ç§ç±»å‹: `"ç›®å‰çŠ¶å†µ"å¸ƒå‘Š`(å®æ—¶æƒ…å†µ),`"æ°”è±¡ç»Ÿè®¡"å¸ƒå‘Š`(å¹³å‡æƒ…å†µ),`"å¤©æ°”é¢„æŠ¥"å¸ƒå‘Š`(å°†æ¥æƒ…å†µ)ã€‚


### é”™è¯¯çš„ç¤ºèŒƒ
```javascript
class WeatherData {
    measurementsChanged() {
        const temp = getTemperature();
        const humidity = getHumidity();
        const pressure = getPressure();

        currentConditionsDisplay.update(temp, humidity, pressure);
        statisticsDisplay.update(temp, humidity, pressure);
        forecastDisplay.update(temp, humidity, pressure);
    }
    // other methods of getter and setter~~
}

// Q: å±äºé”™è¯¯å®ç°çš„åŸå› ?
// A: 1. é’ˆå¯¹å…·ä½“å®ç°ç¼–ç¨‹ï¼Œè€Œéé’ˆå¯¹æ¥å£; 
//    2. å¯¹äºæ¯ä¸ªæ–°çš„å¸ƒå‘Šæ¿ï¼Œéƒ½å¾—ä¿®æ”¹ä»£ç 
//    3. æ— æ³•åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„å¢åŠ ï¼ˆæˆ–åˆ é™¤ï¼‰å¸ƒå‘Šæ¿
```

* ğŸ˜¨** è‡´å‘½ç‚¹: **é’ˆå¯¹å…·ä½“å®ç°ç¼–ç¨‹,ä¼šå¯¼è‡´æˆ‘ä»¬ä»¥ååœ¨å¢åŠ æˆ–åˆ é™¤æ–°ç§ç±»æ—¶å¿…é¡»ä¿®æ”¹ç¨‹åº.


### æ­£ç¡®çš„æ¨¡å¼
* æŒ‰ç…§è§‚å¯Ÿè€…UMLç±»å›¾ï¼Œè®¾è®¡æ°”è±¡ç«™


![image.png | left | 598x287](https://private-alipayobjects.alipay.com/alipay-rmsdeploy-image/skylark/png/0109054ad89b9349.png "")
* å®ç°


```javascript
interface Subject {

  registerObserver(o: Observer): void;
  removerObserver(o: Observer): void;
  notifyObserver(): void;
}

interface Observer {
  update(temp: string, humidity: string, pressure: string): void;
}

interface DisplayBoard {
  display(): void;
}

class WeatherData implements Subject {
  
  private observers = new Set<Observer>();
  private temperature: string;
  private humidity: string;
  private pressure: string;

  registerObserver = (observer: any) => {
    this.observers.add(observer);
  };

  removerObserver = (observer: any) => {
    this.observers.delete(observer);
  };

  notifyObserver = () => {
    this.observers.forEach(observer => {
      observer.update(
        this.temperature,
        this.humidity,
        this.pressure,
      );
    })
  };

  measurementsChanged = () => {
    // å¤©æ°”æ°”è±¡æ•°æ®æ›´æ–°ï¼Œé€šçŸ¥è®¢é˜…è€…
    this.notifyObserver();
  }

  // .... other Methods~~

  getTemperature = () => {
    return this.temperature;
  };

  getHumidity = () => {
    return this.humidity;
  };

  getPressure = () => {
    return this.pressure;
  };

  setTemperature = (temperature) => {
    this.temperature = temperature;
  };

  setHumidity = (humidity) => {
   this.humidity = humidity;
  };

  setPressure = (pressure) => {
   this.pressure = pressure;
  };
}

class CurrentConditionsDisplay implements DisplayBoard, Observer {

  private weatherData: WeatherData;

  constructor(wData: WeatherData) {
    this.weatherData = wData;
    this.weatherData.registerObserver(this);
  }
  update(temp: string, humidity: string, pressure: string) {
    // deal with temp,humidity and pressure
    this.display();
  }
  display() {
    // deal with temp,humidity and pressure
    console.log('å½“å‰å¤©æ°”é¢„æŠ¥â˜ï¸');
  }
  unsubscribe() {
    this.weatherData.removerObserver(this);
  }
}


class StatisticsDisplay implements DisplayBoard, Observer {

  private weatherData: WeatherData;

  constructor(wData: WeatherData) {
    this.weatherData = wData;
    this.weatherData.registerObserver(this);
  }
  update(temp: string, humidity: string, pressure: string) {
    // deal with temp,humidity and pressure
    this.display();    
  }
  display() {
    // deal with temp,humidity and pressure
    console.log('ä»Šæ—¥å¹³å‡æ¸©åº¦ğŸŒ¡ï¸,æ¹¿åº¦ï¼Œæ°”å‹');
  }
}


class ForecastDisplay implements DisplayBoard, Observer {

  private weatherData: WeatherData;

  constructor(wData: WeatherData) {
    this.weatherData = wData;
    this.weatherData.registerObserver(this);
  }
  update(temp: string, humidity: string, pressure: string) {
    // deal with temp,humidity and pressure
    this.display();    
  }
  display() {
    // deal with temp,humidity and pressure
    console.log('æœªæ¥å¤©æ°”é¢„æŠ¥ğŸŒ§');
  }
}

function TestDemo() {

  const weatherData = new WeatherData();
  const curDisplayBoard = new CurrentConditionsDisplay(weatherData);
  const statisticsDisplayBoard = new StatisticsDisplay(weatherData);
  const forecastDisplayBoard = new ForecastDisplay(weatherData);

  weatherData.measurementsChanged();
  console.log('================');
  setTimeout(()=>{}, 1000);
  weatherData.measurementsChanged();
  console.log('================');  
  setTimeout(()=>{}, 1000); 
  curDisplayBoard.unsubscribe();
  weatherData.measurementsChanged();
  console.log('================');  
  weatherData.measurementsChanged();
}

TestDemo();
```

![image.png | left | 676x318](https://private-alipayobjects.alipay.com/alipay-rmsdeploy-image/skylark/png/a126b2d9f09c6290.png "")

## æ€»ç»“ - æŒ‘æˆ˜è®¾è®¡åŸåˆ™

* å°†ç¨‹åºä¸­ä¼šå˜åŒ–çš„æ–¹é¢å’Œå›ºå®šä¸å˜çš„æ–¹é¢ç›¸åˆ†ç¦»
* é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¸é’ˆå¯¹å®ç°ç¼–ç¨‹
* å¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿


è§‚å¯Ÿè€…æ¨¡å¼çš„subjectå’Œobserveréƒ½æ˜¯æ˜¯ç”¨æ¥å£ç¼–ç¨‹ï¼Œåˆ©ç”¨subjectçš„æ¥å£å‘subjectæ³¨å†Œã€‚åˆ©ç”¨â€œç»„åˆâ€å°†è§‚å¯Ÿè€…ç»„åˆè¿›subjectä¸­ã€‚
